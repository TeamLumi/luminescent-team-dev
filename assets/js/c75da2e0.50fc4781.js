"use strict";(globalThis.webpackChunkluminescent_team=globalThis.webpackChunkluminescent_team||[]).push([[647240],{9257(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"exefs/debugging","title":"Debugging","description":"Introduction","source":"@site/rom-hacking/exefs/debugging.md","sourceDirName":"exefs","slug":"/exefs/debugging","permalink":"/luminescent-team-dev/rom-hacking/exefs/debugging","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Logging","permalink":"/luminescent-team-dev/rom-hacking/exefs/logging"},"next":{"title":"Unity","permalink":"/luminescent-team-dev/rom-hacking/category/lumitool-guides"}}');var r=i(474848),s=i(28453);const o={},l="Debugging",d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"How To",id:"how-to",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"debugging",children:"Debugging"})}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"Debugging can be extremely useful when making your exefs mods. It will allow you to view the asm code as it's running, view register values at certain points, and add break points to step through your code."}),"\n",(0,r.jsx)(n.p,{children:"For debugging, you'll need the help of Ghidra (I'm pretty sure you can set up IDA in a similar way), GDB (The GNU Project Debugger) and a GDB Stub (Yuzu or Atmosphere).\r\nThis tutorial assumes you're using Ghidra and Windows with WSL."}),"\n",(0,r.jsx)(n.h2,{id:"how-to",children:"How To"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Set up your GDB Stub. Once you enable the GDB stub your games will hang at startup waiting for a connection.","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"In Yuzu"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Emulation -> Configure -> General -> Debug -> Debugger -> Enable GDB Stub"}),"\n",(0,r.jsx)(n.li,{children:"Take note of the port number here (or change it)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"In Atmosphere"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Ensure your version of Atmosphere is at least version 1.2.4 (System Settings \u2192 System \u2192 \"Current version: ... | AMS X.Y.Z | ...\" under the 'System Update' button)"}),"\n",(0,r.jsx)(n.li,{children:"Modify sd:/atmosphere/config/system_settings.ini (or create it if it doesn't exist) and ensure the following values are set accordingly:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[atmosphere]\r\nenable_htc = u8!0x0\r\nenable_standalone_gdbstub = u8!0x1\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Reboot your Switch"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Set up GDB","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Set up WSL on your PC"}),"\n",(0,r.jsx)(n.li,{children:"Enable SSH into your WSL VM"}),"\n",(0,r.jsxs)(n.li,{children:["Install ",(0,r.jsx)(n.code,{children:"gdb-multiarch"})," to your WSL VM"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Set up Ghidra","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Open the BDSP Main file with debugger (Right click -> Open With -> Debugger)"}),"\n",(0,r.jsxs)(n.li,{children:["Make sure the base address of main is ",(0,r.jsx)(n.code,{children:"0x8004000"})," (this is where yuzu loads the file to)","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Window -> Memory Map -> House Icon At Top Right -> ",(0,r.jsx)(n.code,{children:"8004000"})]}),"\n",(0,r.jsx)(n.li,{children:"This may be different for atmosphere"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Create a new Debugger Target","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"In the Targets window click the green/yellow socket at the top right"}),"\n",(0,r.jsxs)(n.li,{children:["Choose ",(0,r.jsx)(n.code,{children:"GNU gdb via SSH"})," and enter your details (I had to modify the following)","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["GDB launch command: ",(0,r.jsx)(n.code,{children:"usr/bin/gdb-multiarch"})]}),"\n",(0,r.jsxs)(n.li,{children:["SSH username: ",(0,r.jsx)(n.code,{children:"<WSL Username>"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"You may need to edit more or less depending on how you set up your SSH"}),"\n",(0,r.jsx)(n.li,{children:"Click Connect and confirm any SSH details (password, keys etc.)"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Connect and Debug","\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Run BDSP in Yuzu (It will hang at launch when connecting to GDB)"}),"\n",(0,r.jsxs)(n.li,{children:["In the Ghidra Interpreter window enter ",(0,r.jsx)(n.code,{children:"target extended-remote <YourWindowsIP>:<YuzuGDBPort>"})]}),"\n",(0,r.jsx)(n.li,{children:"In the Ghidra Modules window click the two way red arrow (This links your main program with the program loaded in memory)"}),"\n",(0,r.jsx)(n.li,{children:"Set any breakpoints you need in the code (Right click -> Toggle Breakpoint)"}),"\n",(0,r.jsx)(n.li,{children:"In the Ghidra Objects window, continue execution and step through code at breakpoints"}),"\n",(0,r.jsx)(n.li,{children:"In the Ghidra Registers window, view the value of any registers at the current execution location"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453(e,n,i){i.d(n,{R:()=>o,x:()=>l});var t=i(296540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);